
## Hands-on Lab

## Instructor-Optimized, Student-Friendly Version with Solutions Key

This hands-on teaches students how to:

* Build **log queries** in OCI
* Convert log patterns into **custom metrics**
* Plot those metrics on an OCI **dashboard**

We will use logs generated by the **Class Enrollment Web App**. You may optionally update the application code to produce structured logs for better metrics.


## 1. Background Concepts (Short & Clear)

## 1.1 What Are Logging-Based Metrics?

Logging-based metrics let you turn **log events** into **numeric measurements**.

Examples:

* Count of 5xx errors per minute
* Number of failed login attempts
* Enrollment success count
* Slow request warnings

This is useful when:

* Your app does NOT expose custom metrics
* You rely on logs as the primary data source


## 1.2 Why Logging-Based Metrics Matter for SRE

They allow you to:

* Tie log patterns to SLO indicators
* Generate alerts from critical logs
* Visualize application behaviors
* Detect anomalies from log-based events

Examples:

* Create a metric for "5xx per minute" and trigger an alarm
* Build a graph for failed enrollments


## 1.3 Optional: Improve App Logs for Better Metrics

The Class Enrollment **Flask** backend uses default logging.
To enrich logs, you can add structured log messages.

### Add to `app.py`:

```python
import logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s %(levelname)s %(message)s')

@app.route('/enroll', methods=['POST'])
def enroll():
    try:
        # existing logic
        logging.info("ENROLL_SUCCESS user=%s class=%s", user_id, class_id)
    except Exception as e:
        logging.error("ENROLL_FAIL user=%s class=%s error=%s", user_id, class_id, str(e))
        raise
```

This allows OCI Logging to detect patterns like:

* `ENROLL_SUCCESS`
* `ENROLL_FAIL`

You will use these patterns in your logging query.


## 2. Hands-On Task 1 — Create a Logging Query

## **Purpose:** Identify patterns in logs for generating metrics.


## Steps:

1. Open **Navigation Menu (☰) → Observability & Management → Logging**.

2. Click **Log Groups**.

3. Select your log group: `<student-id>-log-group`.

4. Open your application log or syslog:

   * `<student-id>-syslog`
   * OR
   * `<student-id>-app-log` (if created)

5. Click **Search**.

6. Enter a query such as:

   * Count failed enrollments:

     ```
     'ENROLL_FAIL'
     ```
   * Count successful enrollments:

     ```
     'ENROLL_SUCCESS'
     ```
   * Count 5xx:

     ```
     level = 'ERROR'
     ```

7. Run the query.


## Expected Result:

* You see log entries that match the selected pattern.
* You validate the logs contain measurable activities.


## 3. Hands-On Task 2 — Create a Metric From Log Query

## **Purpose:** Convert log patterns into a metric.

OCI can convert **any log query** into a **custom metric**.


## Steps:

1. With your log query active, click **Save as Metric**.
2. Fill the details:

   * **Metric Name:** `<student-id>-enroll-failures`
   * **Namespace:** `<student-id>-custom-metrics`
   * **Unit:** `count`
   * **Interval:** `1m`
3. Save the metric.

OCI now emits a new metric **every minute** based on matching logs.


## What You Should See:

* Metric creation confirmation
* A new metric available in Metric Explorer


## 4. Hands-On Task 3 — Plot the Metric in a Dashboard

## **Purpose:** Visualize log-derived metrics.


## Steps:

1. Open **Observability & Management → Dashboards**.
2. Select your dashboard:

   * `<student-id>-sre-dashboard`
3. Click **Add Widget → Metric Chart**.
4. Choose:

   * **Namespace:** `<student-id>-custom-metrics`
   * **Metric Name:** `<student-id>-enroll-failures`
5. Configure:

   * **Statistic:** `Sum`
   * **Interval:** `1 minute`
6. Title the chart:

   * `Enrollment Failures Per Minute`
7. Click **Create**.


## Expected Result:

* A line chart showing spikes when failures occur
* Flat line (0) when system is healthy


## 5. Summary of the Hands-On

In this exercise, you:

* Queried logs using log search
* Created a custom log-based metric
* Added the metric to an OCI dashboard

This is critical for:

* Error budget tracking
* Detecting production anomalies
* Creating actionable alarms


## 6. Solutions Key (Instructor Reference)

Below is a reference solution. Student answers may vary depending on patterns found in logs.


## ✔ Solution Key — Logging Query

Expected working queries:

* For failed enrollments:

  ```
  'ENROLL_FAIL'
  ```
* For successful enrollments:

  ```
  'ENROLL_SUCCESS'
  ```
* For errors:

  ```
  level = 'ERROR'
  ```

If structured logs were added, these patterns appear frequently.


## ✔ Solution Key — Metric Creation

Expected:

* Metric Name: `<student-id>-enroll-failures`
* Namespace: `<student-id>-custom-metrics`
* Interval: `1 minute`
* Unit: `count`

Metric should appear in **Metric Explorer** within 2–3 minutes.


## ✔ Solution Key — Dashboard Plot

Expected visualization:

* Title: "Enrollment Failures Per Minute"
* Namespace: `<student-id>-custom-metrics`
* Metric Name: `<student-id>-enroll-failures`
* Statistic: `Sum`
* Spikes only appear during failed enrollment attempts

